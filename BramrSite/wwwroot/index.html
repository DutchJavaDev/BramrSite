<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>BramrSite</title>
    <base href="/" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="Stylesheet" href="css/StylesheetIndex.css">
    <link rel="Stylesheet" href="css/menuWeb.css">
    <link href="css/app.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />

</head>

<body>
    <app>Loading...</app>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>
    <script src="https://kit.fontawesome.com/8993f9dff3.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.sound.min.js"></script>

    <script src="https://unpkg.com/ml5@0.5.0/dist/ml5.min.js"></script>

    <script type="text/javascript">
        function updateContainer() {
            const signUpButton = document.getElementById('signUp');
            const signInButton = document.getElementById('signIn');
            const container = document.getElementById('container');

            signUpButton.addEventListener('click', () => {
                container.classList.add("right-panel-active");
            });

            signInButton.addEventListener('click', () => {
                container.classList.remove("right-panel-active");
            });
        };
        //const video = document.getElementById("myvideo");
        //const canvas = document.getElementById("canvas");


        let label = "waiting...";
        let confidence = "score...";

        let classifier;
        let modelURL = 'https://teachablemachine.withgoogle.com/models/S4O5iAMtu/';

        var accessGranted = false;
        var ProvideInfo = false;
        function preload() {
            classifier = ml5.imageClassifier(modelURL + 'model.json');
        }



        function setup() {
            createCanvas(640, 520);

            video = createCapture(VIDEO);
            video.hide();

            classifyVideo();
        }


        function classifyVideo() {
            classifier.classify(video, gotResults);
        }

        function draw() {
            let accesLabel = document.getElementById("accesLabel");
            let countNummer = document.getElementById("count");
            let count2Nummer = document.getElementById("count2");
            let grantedText = document.getElementById("granted");

            let count;
            let count2;
            
            

            background(0);

            // Draw the video
            image(video, 0, 0);

            // STEP 4: Draw the label
            textSize(32);
            textAlign(CENTER, CENTER);
            fill(255);
            text(label, width / 2, height - 16);


            let emoji = "access denied";
            if (label == "ring") {
                emoji = "Ring Approved";
                
                count = 1;
                countNummer.innerText = count;
                
                
            } 
            else if (label == "Blank") {
                emoji = "access denied";
            }else if (label == "Art") {

                emoji = "access granted";
                ProvideInfo = true;
            }else if (label == "Wrong ring") {
                emoji = "access denied";
            }
            if (label == "watch") {
                count2 = 1;
                count2Nummer.innerText = count2;
                if (count2 == 1 & count == 1)  {
                    accessGranted = true;

                    grantedText.innerText = "true";
                }
            }
           
           
            if (ProvideInfo == true) {
                accesLabel.innerText = "Art pls provide Proof";
            }
            if (accessGranted == true) {
                accesLabel.innerText = "Page unlocked";
                grantedText.innerText = "true";
            }

            textSize(20);
            text(emoji, width / 2, height / 2);
        }


        function gotResults(error, results) {

            if (error) {
                console.error(error);
                return;
            }

            label = results[0].label;
            confidence = results[0].confidence;
            classifyVideo();
        }
    </script>

    <script src="JS/Handtracking.js"></script>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>


    <!--<script src="JS/app.js"></script>-->
</body>

</html>
